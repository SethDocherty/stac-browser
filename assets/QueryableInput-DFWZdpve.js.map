{"version":3,"mappings":"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","names":["_sfc_main","BDropdown","BDropdownItemButton","defineAsyncComponent","__vitePreload","DatePickerMixin","option","v","newValues","coerced","CqlValue","findIndex","op","nextIndex","evt","val","Utils","tag","currentArr","event","clipboardData","pasted","items","s","currentSet","newItems","item","itemType","parsed","_hoisted_1","_hoisted_2","_hoisted_3","_openBlock","_createElementBlock","_createElementVNode","_toDisplayString","$props","_createVNode","_component_b_dropdown","$options","_Fragment","_renderList","_createBlock","_component_b_dropdown_item_button","$event","_component_b_badge","_createTextVNode","_component_VueDatePicker","_ctx","_component_b_form_select","_mergeProps","_cache","_component_b_form_input","_component_multiselect","_component_b_form_checkbox","_component_b_button","_component_b_icon_x_circle_fill","_hoisted_4","_component_Description"],"ignoreList":[],"sources":["../../src/components/QueryableInput.vue"],"sourcesContent":["<template>\n  <div class=\"queryable-group\">\n    <div class=\"queryable-row\">\n      <span class=\"title\">\n        {{ queryable.title }}\n      </span>\n\n      <b-dropdown size=\"sm\" class=\"op\" variant=\"dark\" split :text=\"operator.label\" @click=\"iterateOps\">\n        <b-dropdown-item-button\n          v-for=\"op in operators\"\n          :key=\"op.SYMBOL\"\n          :active=\"op === operator\"\n          @click=\"updateOperator(op)\"\n          button-class=\"d-flex justify-content-between align-items-center\"\n        >\n          <span>{{ op.longLabel }}</span>\n          <b-badge variant=\"dark\" class=\"ms-2\">{{ op.label }}</b-badge>\n        </b-dropdown-item-button>\n      </b-dropdown>\n\n      <VueDatePicker\n        v-if=\"queryable.isTemporal\"\n        class=\"value\"\n        :model-value=\"value?.value\"\n        @update:model-value=\"updateValue\"\n        :locale=\"datepickerLang\"\n        :week-start=\"weekStartDay\"\n        :formats=\"{ input: queryable.isDateTime ? dateTimeFormat : dateFormat }\"\n        :close-on-scroll=\"false\"\n        :time-config=\"{ \n          enableTimePicker: queryable.isDateTime,\n          seconds: queryable.isDateTime,\n          timePickerInline: true \n        }\"\n        :input-attrs=\"{ clearable: true }\"\n        auto-apply\n      />\n\n      <b-form-select\n        v-else-if=\"queryable.isSelection\"\n        :options=\"queryableOptions\"\n        size=\"sm\"\n        class=\"value\"\n        :model-value=\"value.value\"\n        @update:model-value=\"updateValue($event)\"\n        v-bind=\"validation\"\n      />\n      <b-form-input\n        v-else-if=\"queryable.isText || queryable.isNumeric\"\n        size=\"sm\"\n        class=\"value\"\n        :model-value=\"value.value\"\n        @update:model-value=\"updateValue($event)\"\n        v-bind=\"validation\"\n      />\n      <multiselect\n        v-else-if=\"queryable.isArray\"\n        class=\"value\"\n        v-model=\"arrayValues\"\n        :multiple=\"true\"\n        :taggable=\"true\"\n        :options=\"arrayValues\"\n        :placeholder=\"$t('search.arrayInput.helpText')\"\n        :tag-placeholder=\"$t('search.arrayInput.addValue')\"\n        @tag=\"addArrayValue\"\n        @paste=\"onArrayPaste\"\n      >\n        <template #noOptions>{{ $t('search.noOptions') }}</template>\n      </multiselect>\n      <b-form-checkbox\n        v-else-if=\"queryable.isBoolean\"\n        switch\n        class=\"value\"\n        :model-value=\"value.value\"\n        @update:model-value=\"updateValue($event)\"\n        v-bind=\"validation\"\n      >\n        {{ $t(`checkbox.${value.value}`) }}\n      </b-form-checkbox>\n\n      <b-button class=\"delete\" size=\"sm\" variant=\"danger\" @click=\"$emit('remove-queryable')\">\n        <b-icon-x-circle-fill aria-hidden=\"true\" />\n      </b-button>\n    </div>\n\n    <div v-if=\"queryable.description || operator.description\" class=\"queryable-help text-muted small\">\n      <Description v-if=\"operator.description\" :description=\"operator.description\" inline />\n      <Description v-if=\"queryable.description\" :description=\"queryable.description\" inline />\n    </div>\n  </div>\n</template>\n\n<script>\nimport { defineAsyncComponent } from 'vue';\n\nimport { BDropdown, BDropdownItemButton } from 'bootstrap-vue-next';\n\nimport DatePickerMixin from './DatePickerMixin';\nimport Utils from '../utils';\nimport CqlValue from '../models/cql2/value';\n    \nexport default {\n  name: 'QueryableInput',\n  components: {\n    BDropdown,\n    BDropdownItemButton,\n    Description: defineAsyncComponent(() => import('./Description.vue')),\n    Multiselect: defineAsyncComponent(() => import('vue-multiselect'))\n  },\n  mixins: [\n    DatePickerMixin\n  ],\n  props: {\n    // eslint-disable-next-line\n    value: {\n      // Any type is allowed\n    },\n    operator: {\n      type: Function,\n      required: true\n    },\n    queryable: {\n      type: Object,\n      required: true\n    },\n    cql: {\n      type: Object,\n      required: true\n    }\n  },\n  emits: [\n    'remove-queryable',\n    'update:value',\n    'update:operator'\n  ],\n  computed: {\n    validation() {\n      if (this.queryable.isText) {\n        return {\n          type: 'text',\n          minlength: this.schema.minLength,\n          maxlength: this.schema.maxLength,\n          required: this.schema.minLength > 0\n        };\n      }\n      else if (this.queryable.isNumeric) {\n        return {\n          type: 'number',\n          number: true,\n          min: this.schema.minimum,\n          max: this.schema.maximum,\n          step: this.schema.multipleOf || 'any'\n        };\n      }\n      return {};\n    },\n    schema() {\n      return this.queryable.schema;\n    },\n    operators() {\n      return this.queryable.getOperators(this.cql);\n    },\n    queryableOptions() {\n      if (this.queryable.isSelection) {\n        return this.schema.enum.map(option => ({\n          value: option,\n          text: option\n        }));\n      }\n      return [];\n    },\n    arrayValues: {\n      get() {\n        const arr = this.value?.value || [];\n        return arr.map(v => String(v));\n      },\n      set(newValues) {\n        const coerced = newValues.map(v => this.coerceArrayItem(v));\n        this.$emit('update:value', CqlValue.create(coerced));\n      }\n    }\n  },\n  methods: {\n    iterateOps() {\n      let findIndex = this.operators.findIndex(op => op === this.operator);\n      let nextIndex = ++findIndex % this.operators.length;\n      this.updateOperator(this.operators[nextIndex]);\n    },\n    updateValue(evt) {\n      let val = Utils.isObject(evt) && 'target' in evt ? evt.target.value : evt;\n      if (typeof val === \"string\" && this.queryable.is('integer')) {\n        val = parseInt(val, 10);\n      }\n      else if (typeof val === \"string\" && this.queryable.is('number')) {\n        val = parseFloat(val);\n      }\n      this.$emit('update:value', CqlValue.create(val));\n    },\n    updateOperator(op) {\n      this.$emit('update:operator', op);\n    },\n    addArrayValue(tag) {\n      const coerced = this.coerceArrayItem(tag.trim());\n      const currentArr = this.value?.value || [];\n      this.$emit('update:value', CqlValue.create([...currentArr, coerced]));\n    },\n    onArrayPaste(event) {\n      const clipboardData = event.clipboardData || window.clipboardData;\n      if (!clipboardData) {\n        return;\n      }\n      const pasted = clipboardData.getData('text');\n      if (!pasted || !pasted.includes(',')) {\n        return;\n      }\n      event.preventDefault();\n      const items = pasted.split(',').map(s => s.trim()).filter(s => s !== '');\n      const currentArr = this.value?.value || [];\n      const currentSet = new Set(currentArr.map(String));\n      const newItems = items\n        .filter(item => !currentSet.has(item))\n        .map(item => this.coerceArrayItem(item));\n      if (newItems.length > 0) {\n        this.$emit('update:value', CqlValue.create([...currentArr, ...newItems]));\n      }\n    },\n    coerceArrayItem(item) {\n      const itemType = this.queryable?.schema?.items?.type;\n      if (itemType === 'integer') {\n        const parsed = parseInt(item, 10);\n        if (!Number.isNaN(parsed) && String(parsed) === item) {\n          return parsed;\n        }\n      }\n      else if (itemType === 'number') {\n        const parsed = parseFloat(item);\n        if (Number.isFinite(parsed)) {\n          return parsed;\n        }\n      }\n      return item;\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\">\n@import 'bootstrap/scss/mixins';\n@import \"../theme/variables.scss\";\n@import '../theme/datepicker.scss';\n\n.queryable-row {\n  margin: 0.25em 0;\n  gap: 0.5em;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  align-content: center;\n  display: flex;\n\n  .title, .value {\n    flex-grow: 4;\n    width: 7rem !important;\n  }\n  .op {\n    min-width: 4rem;\n    width: auto;\n  }\n  .delete {\n    width: auto;\n  }\n}\n\n.queryable-help {\n  display: block;\n  margin: 0.25em 0 1em 0;\n  line-height: 1.1em;\n}\n\n.queryable-group {\n  margin: 0.75em 0;\n}\n</style>\n"],"file":"QueryableInput-DFWZdpve.js"}